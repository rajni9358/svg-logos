<p>In Python, <strong>Metaprogramming</strong> refers to the practice of writing code that has knowledge of itself and can be manipulated. The <strong><a href="/python/python_metaclasses.htm">metaclasses</a></strong> are a powerful tool for metaprogramming in Python, allowing you to customize how classes are created and behave. Using metaclasses, you can create more flexible and efficient programs through dynamic code generation and reflection.</p>
<p><strong>Metaprogramming</strong> in Python involves techniques such as <a href="/python/python_decorators.htm" target="_blank">decorators</a> and metaclasses. In this tutorial, you will learn about <strong>metaprogramming with metaclasses</strong> by exploring dynamic code generation and <a href="/python/python_reflection.htm" target="_blank">reflection</a>.</p>
<h2>Defining Metaclasses</h2>
<p>Metaprogramming with metaclasses in Python offer advanced features of enabling advanced capabilities to your program. One such feature is the <strong>__prepare__()</strong> method, which allows customization of the namespace where a class body will be executed.</p>
<p>This method is called before any class body code is executed, providing a way to initialize the class namespace with additional attributes or methods. The <strong>__prepare__()</strong> method should be implemented as a <strong>classmethod</strong>.</p>
<h3>Example</h3>
<p>Here is an example of creating metaclass with advanced features using the <strong>__prepare__()</strong> method.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">class</span> <span class="token class-name">MyMetaClass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token decorator annotation punctuation">@classmethod</span> <span class="token keyword">def</span> <span class="token function">__prepare__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Preparing namespace for </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token comment"># Customize the namespace preparation here</span> custom_namespace <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__prepare__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> custom_namespace<span class="token punctuation">[</span><span class="token string">'CONSTANT_VALUE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token keyword">return</span> custom_namespace <span class="token comment"># Define a class using the custom metaclass</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MyMetaClass<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>value <span class="token operator">=</span> value <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Value: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span><span class="token string">, Constant: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>CONSTANT_VALUE<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment"># Instantiate the class</span> obj <span class="token operator">=</span> MyClass<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span> obj<span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span></div>
</div>
<p><strong>Output</strong></p>
<p>While executing above code, you will get the following results &minus;</p>
<pre class="result notranslate">Preparing namespace for MyClass
Value: 42, Constant: 100
</pre>
<div class="inserted-div">&nbsp;</div>
<h2>Dynamic Code Generation with Metaclasses</h2>
<p>Metaprogramming with metaclasses enables the creation or modification of code during runtime.</p>
<h3>Example</h3>
<p>This example demonstrates how <strong>metaclasses</strong> in Python metaprogramming can be used for dynamic code generation.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">class</span> <span class="token class-name">MyMeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Defining class: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment"># Dynamic attribute to the class</span> attrs<span class="token punctuation">[</span><span class="token string">'dynamic_attribute'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Added dynamically'</span> <span class="token comment"># Dynamic method to the class</span> <span class="token keyword">def</span> <span class="token function">dynamic_method</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"This is a dynamically added method for </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span> attrs<span class="token punctuation">[</span><span class="token string">'dynamic_method'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dynamic_method <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span> <span class="token comment"># Define a class using the metaclass</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MyMeta<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span> obj <span class="token operator">=</span> MyClass<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>dynamic_attribute<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>dynamic_method<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div>
</div>
<p><strong>Output</strong></p>
<p>On executing above code, you will get the following results &minus;</p>
<pre class="result notranslate">Defining class: MyClass
Added dynamically
This is a dynamically added method for MyClass
</pre>
<h2>Reflection and Metaprogramming</h2>
<p>Metaprogramming with metaclasses often involves reflection, allowing for introspection and modification of class attributes and methods at runtime.</p>
<h3>Example</h3>
<p>In this example, the <strong>MyMeta</strong> metaclass inspects and prints the attributes of the <strong>MyClass</strong> during its creation, demonstrating how metaclasses can introspect and modify class definitions dynamically.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">class</span> <span class="token class-name">MyMeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> dct<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Inspect class attributes and print them</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Class attributes for </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>dct<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> dct<span class="token punctuation">)</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MyMeta<span class="token punctuation">)</span><span class="token punctuation">:</span> data <span class="token operator">=</span> <span class="token string">"example"</span></div>
</div>
<p><strong>Output</strong></p>
<p>On executing above code, you will get the following results &minus;</p>
<pre class="result notranslate">Class attributes for MyClass: {'__module__': '__main__', '__qualname__': 'MyClass', 'data': 'example'}
</pre>
<div class="library-page-bottom-nav ">&nbsp;</div>
<div class="bottom-library-ads mt" style="margin: 5px;">
<div id="google-bottom-ads" class="google-bottom-ads">
<div style="width: 728px; height: 250px;">&nbsp;</div>
</div>
</div>