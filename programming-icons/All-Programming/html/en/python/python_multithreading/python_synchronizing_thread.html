<p>In Python, when multiple threads are working concurrently with shared resources, it's important to synchronize their access to maintain data integrity and program correctness. Synchronizing threads in python can be achieved using various synchronization primitives provided by the <strong>threading</strong> module, such as locks, conditions, semaphores, and barriers to control access to shared resources and coordinate the execution of multiple threads.</p>
<p>In this tutorial, we'll learn about various synchronization primitives provided by Python's <strong>threading</strong> module.</p>
<h2>Thread Synchronization using Locks</h2>
<p>The lock object in the Python's threading module provide the simplest synchronization primitive. They allow threads to acquire and release locks around critical sections of code, ensuring that only one thread can execute the protected code at a time.</p>
<p>A new lock is created by calling the <strong>Lock()</strong> method, which returns a lock object. The lock can be acquired using the <strong>acquire(blocking)</strong> method, which force the threads to run synchronously. The optional blocking parameter enables you to control whether the thread waits to acquire the lock and released using the <strong>release()</strong> method.</p>
<h3>Example</h3>
<p>The following example demonstrates how to use locks (the threading.Lock() method) to synchronize threads in Python, ensuring that multiple threads access shared resources safely and correctly.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">import</span> threading counter <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">def</span> <span class="token function">increment</span><span class="token punctuation">(</span>theLock<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">global</span> counter <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span> theLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> counter <span class="token operator">+=</span> <span class="token number">1</span> theLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span> t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>increment<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>lock<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>increment<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>lock<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span> t3 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>increment<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>lock<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> t3<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Wait for all threads to complete</span> <span class="token keyword">for</span> thread <span class="token keyword">in</span> <span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">:</span> thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"All threads have completed"</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The Final Counter Value:"</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span></div>
</div>
<h3>Output</h3>
<p>When the above code is executed, it produces the following output &minus;</p>
<pre class="result notranslate">All threads have completed
The Final Counter Value: 26
</pre>
<div class="inserted-div">&nbsp;</div>
<h2>Condition Objects for Synchronizing Python Threads</h2>
<p>Condition variables enable threads to wait until notified by another thread. They are useful for providing <a href="/python/python_interthread_communication.htm">communication between the threads</a>. The <strong>wait()</strong> method is used to block a thread until it is notified by another thread through <strong>notify()</strong> or <strong>notify_all()</strong>.</p>
<h3>Example</h3>
<p>This example demonstrates how Condition objects can synchronize threads using the <strong>notify()</strong> and <strong>wait()</strong> methods.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">import</span> threading counter <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># Consumer function</span> <span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>cv<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">global</span> counter <span class="token keyword">with</span> cv<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Consumer is waiting"</span><span class="token punctuation">)</span> cv<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Wait until notified by increment</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Consumer has been notified. Current Counter value:"</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span> <span class="token comment"># increment function</span> <span class="token keyword">def</span> <span class="token function">increment</span><span class="token punctuation">(</span>cv<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">global</span> counter <span class="token keyword">with</span> cv<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"increment is producing items"</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> counter <span class="token operator">+=</span> i <span class="token comment"># Increment counter by i</span> <span class="token comment"># Notify the consumer </span> cv<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Increment has finished"</span><span class="token punctuation">)</span> <span class="token comment"># Create a Condition object</span> cv <span class="token operator">=</span> threading<span class="token punctuation">.</span>Condition<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Create and start threads</span> consumer_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>cv<span class="token punctuation">]</span><span class="token punctuation">)</span> increment_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>increment<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>cv<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> consumer_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> increment_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> consumer_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> increment_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The Final Counter Value:"</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span></div>
</div>
<h3>Output</h3>
<p>On executing the above program, it will produce the following output &minus;</p>
<pre class="result notranslate">Consumer is waiting
increment is producing items
Increment has finished
Consumer has been notified. Current Counter value: 15
The Final Counter Value: 15
</pre>
<h2>Synchronizing threads using the join() Method</h2>
<p>The <strong>join()</strong> method in Python's threading module is used to wait until all threads have completed their execution. This is a straightforward way to synchronize the main thread with the completion of other threads.</p>
<h3>Example</h3>
<p>This demonstrates synchronization of threads using the <strong>join()</strong> method to ensure that the main thread waits for all started threads to complete their work before proceeding.</p>
<div class="code-wrapper">
<div class="code-header">
<div class="logo-side">&nbsp;</div>
<div class="button-side">
<div class="execute">&nbsp;</div>
<div class="open-compiler">Open Compiler</div>
</div>
</div>
<div class="code-mirror  language-python" style="outline: none; overflow-wrap: break-word; overflow-y: auto; white-space: pre-wrap;" contenteditable="plaintext-only" spellcheck="false"><span class="token keyword">import</span> threading <span class="token keyword">import</span> time <span class="token keyword">class</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> threadID<span class="token punctuation">,</span> name<span class="token punctuation">,</span> counter<span class="token punctuation">)</span><span class="token punctuation">:</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span> self<span class="token punctuation">.</span>threadID <span class="token operator">=</span> threadID self<span class="token punctuation">.</span>name <span class="token operator">=</span> name self<span class="token punctuation">.</span>counter <span class="token operator">=</span> counter <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting "</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span> print_time<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">print_time</span><span class="token punctuation">(</span>threadName<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> counter<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">while</span> counter<span class="token punctuation">:</span> time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>delay<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threadName<span class="token punctuation">,</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> counter <span class="token operator">-=</span> <span class="token number">1</span> threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># Create new threads</span> thread1 <span class="token operator">=</span> MyThread<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Thread-1"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> thread2 <span class="token operator">=</span> MyThread<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Thread-2"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># Start the new Threads</span> thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Join the threads</span> thread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> thread2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exiting Main Thread"</span><span class="token punctuation">)</span></div>
</div>
<h3>Output</h3>
<p>On executing the above program, it will produce the following output &minus;</p>
<pre class="result notranslate">Starting Thread-1
Starting Thread-2
Thread-1: Mon Jul  1 16:05:14 2024
Thread-2: Mon Jul  1 16:05:15 2024
Thread-1: Mon Jul  1 16:05:15 2024
Thread-1: Mon Jul  1 16:05:16 2024
Thread-2: Mon Jul  1 16:05:17 2024
Thread-2: Mon Jul  1 16:05:19 2024
Exiting Main Thread
</pre>
<h2>Additional Synchronization Primitives</h2>
<p>In addition to the above synchronization primitives, Python's threading module offers: &minus;</p>
<ul class="list">
<li><strong>RLocks (Reentrant Locks):</strong> A variant of locks that allow a thread to acquire the same lock multiple times before releasing it, useful in recursive functions or nested function calls.</li>
<li><strong>Semaphores:</strong>Similar to locks but with a counter. Threads can acquire the semaphore up to a certain limit defined during initialization. Semaphores are useful for limiting access to resources with a fixed capacity.</li>
<li><strong>Barriers:</strong> Allows a fixed number of threads to synchronize at a barrier point and continue executing only when all threads have reached that point. Barriers are useful for coordinating a group of threads that must all complete a certain phase of execution before any of them can proceed further.</li>
</ul>
<div class="library-page-bottom-nav ">&nbsp;</div>
<div class="bottom-library-ads mt" style="margin: 5px;">
<div id="google-bottom-ads" class="google-bottom-ads">
<div style="width: 728px; height: 250px;">&nbsp;</div>
</div>
</div>